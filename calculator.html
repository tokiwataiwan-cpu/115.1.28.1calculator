<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>遺產繼承試算 | 第一顧問 Top One Consulting</title>
    <style>
        :root {
            --primary-blue: #002347; /* 深海藍 */
            --gold: #D4AF37;       /* 晨曦金 */
            --bg-light: #f9f9f9;
        }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg-light); color: #333; line-height: 1.6; }
        .container { max-width: 800px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 5px solid var(--gold); }
        h2 { color: var(--primary-blue); text-align: center; }
        .input-group { margin-bottom: 20px; padding: 15px; border-bottom: 1px solid #eee; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input[type="number"], select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 15px; background: var(--primary-blue); color: var(--gold); border: none; font-size: 1.1rem; cursor: pointer; border-radius: 4px; font-weight: bold; margin-top: 10px; }
        
        .result-box { margin-top: 30px; display: none; }
        .heir-list { border-left: 4px solid var(--gold); padding-left: 15px; margin-bottom: 20px; }
        .excluded-list { background: #f0f2f5; padding: 15px; border-radius: 4px; border-left: 4px solid #999; color: #666; }
        .highlight { color: var(--gold); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>第一顧問：遺產分配與特留分試算</h2>
    
    <div class="input-group">
        <label>總遺產金額 (新台幣)</label>
        <input type="number" id="totalAmount" placeholder="請輸入金額" value="10000000">
    </div>

    <div class="input-group">
        <label>配偶是否健在？</label>
        <select id="hasSpouse">
            <option value="yes">是</option>
            <option value="no">否</option>
        </select>
    </div>

    <div class="input-group">
        <label>各順位人數 (若無則填0)</label>
        <p><small>註：採「有前無後」原則，若第一順位有人，後續順位將無權繼承。</small></p>
        第一順位 (子女/孫子女)：<input type="number" id="rank1" value="0" min="0"><br><br>
        第二順位 (父母)：<input type="number" id="rank2" value="0" min="0"><br><br>
        第三順位 (兄弟姊妹)：<input type="number" id="rank3" value="0" min="0"><br><br>
        第四順位 (祖父母)：<input type="number" id="rank4" value="0" min="0">
    </div>

    <button onclick="calculate()">開始法律試算</button>

    <div id="result" class="result-box">
        <h3 style="color:var(--primary-blue);">試算結果</h3>
        <div id="heirInfo" class="heir-list"></div>
        
        <h4 style="color:#666;">⚠️ 無法得到遺產的人</h4>
        <div id="excludedInfo" class="excluded-list"></div>
    </div>
</div>

<script>
function calculate() {
    const total = parseFloat(document.getElementById('totalAmount').value);
    const hasSpouse = document.getElementById('hasSpouse').value === 'yes';
    const r1 = parseInt(document.getElementById('rank1').value) || 0;
    const r2 = parseInt(document.getElementById('rank2').value) || 0;
    const r3 = parseInt(document.getElementById('rank3').value) || 0;
    const r4 = parseInt(document.getElementById('rank4').value) || 0;

    let heirText = "";
    let excludedText = "";
    document.getElementById('result').style.display = 'block';

    // 邏輯判定：誰是有效繼承人
    let activeRank = 0;
    if (r1 > 0) activeRank = 1;
    else if (r2 > 0) activeRank = 2;
    else if (r3 > 0) activeRank = 3;
    else if (r4 > 0) activeRank = 4;

    // 計算分配比例 (依據民法 1144 條)
    if (activeRank === 0 && !hasSpouse) {
        heirText = "無法律規定之繼承人，遺產可能歸屬國庫。";
    } else {
        // 配偶比例計算 
        let spouseShare = 0;
        let othersShare = 0;
        let numOthers = 0;

        if (activeRank === 1) {
            numOthers = r1;
            spouseShare = 1 / (numOthers + 1); // 與第一順位平均 
            othersShare = 1 / (numOthers + 1);
        } else if (activeRank === 2 || activeRank === 3) {
            numOthers = (activeRank === 2) ? r2 : r3;
            spouseShare = 1 / 2; // 與二、三順位同為繼承時為 1/2 
            othersShare = (1 / 2) / numOthers;
        } else if (activeRank === 4) {
            numOthers = r4;
            spouseShare = 2 / 3; // 與四順位同為繼承時為 2/3 
            othersShare = (1 / 3) / numOthers;
        } else {
            spouseShare = 1; // 無其他順位 
        }

        if (!hasSpouse) {
            spouseShare = 0;
            othersShare = 1 / numOthers;
        }

        // 輸出能得到遺產的人
        if (hasSpouse) {
            heirText += `<li><b>配偶：</b> 應繼分 ${(spouseShare*100).toFixed(1)}% (約 NT$${(total*spouseShare).toLocaleString()})，<span class="highlight">特留分 ${(spouseShare*100/2).toFixed(1)}%</span></li>`;
        }
        if (activeRank > 0) {
            const rankNames = ["", "第一順位(子女)", "第二順位(父母)", "第三順位(兄弟姊妹)", "第四順位(祖父母)"];
            // 特留分比例判定 [cite: 1, 2]
            let portionBase = (activeRank <= 2) ? 0.5 : (1/3); 
            heirText += `<li><b>${rankNames[activeRank]} (共 ${numOthers} 人)：</b> 每人應繼分 ${(othersShare*100).toFixed(1)}%，<span class="highlight">特留分 ${(othersShare*100*portionBase).toFixed(1)}%</span></li>`;
        }
    }

    // 邏輯判定：排除名單 (第 1138 條：有前無後) 
    if (activeRank === 1) excludedText += "<li>因第一順位有人，故第二、三、四順位繼承人均無權繼承。</li>";
    else if (activeRank === 2) excludedText += "<li>因第二順位有人，故第三、四順位繼承人均無權繼承。</li>";
    else if (activeRank === 3) excludedText += "<li>因第三順位有人，故第四順位繼承人無權繼承。</li>";
    
    if (activeRank === 0 && !hasSpouse) excludedText = "查無符合民法 1138 條之繼承人。";
    else if (excludedText === "") excludedText = "目前無明確被排除之順位。";

    document.getElementById('heirInfo').innerHTML = heirText;
    document.getElementById('excludedInfo').innerHTML = excludedText;
}
</script>

</body>
</html>